function cov_2mk2n4jli2(){var path="/home/raposo/projects/testesnodejs/05-tdd-project/test/unitTests/carService.test.js";var hash="6d0ac26176e2089419aa5776dc17bbf549412e0d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/raposo/projects/testesnodejs/05-tdd-project/test/unitTests/carService.test.js",statementMap:{"0":{start:{line:1,column:56},end:{line:1,column:72}},"1":{start:{line:2,column:19},end:{line:2,column:60}},"2":{start:{line:3,column:20},end:{line:3,column:63}},"3":{start:{line:5,column:17},end:{line:5,column:32}},"4":{start:{line:6,column:19},end:{line:6,column:34}},"5":{start:{line:7,column:14},end:{line:7,column:30}},"6":{start:{line:9,column:21},end:{line:9,column:69}},"7":{start:{line:11,column:14},end:{line:15,column:1}},"8":{start:{line:17,column:0},end:{line:146,column:2}},"9":{start:{line:18,column:21},end:{line:18,column:23}},"10":{start:{line:19,column:18},end:{line:19,column:20}},"11":{start:{line:20,column:4},end:{line:24,column:6}},"12":{start:{line:21,column:8},end:{line:23,column:10}},"13":{start:{line:25,column:4},end:{line:27,column:6}},"14":{start:{line:26,column:8},end:{line:26,column:39}},"15":{start:{line:29,column:4},end:{line:31,column:6}},"16":{start:{line:30,column:8},end:{line:30,column:25}},"17":{start:{line:33,column:4},end:{line:38,column:6}},"18":{start:{line:34,column:21},end:{line:34,column:36}},"19":{start:{line:35,column:23},end:{line:35,column:66}},"20":{start:{line:37,column:8},end:{line:37,column:59}},"21":{start:{line:40,column:4},end:{line:55,column:6}},"22":{start:{line:41,column:28},end:{line:41,column:50}},"23":{start:{line:42,column:27},end:{line:42,column:28}},"24":{start:{line:44,column:8},end:{line:47,column:29}},"25":{start:{line:50,column:23},end:{line:50,column:62}},"26":{start:{line:51,column:25},end:{line:51,column:55}},"27":{start:{line:53,column:8},end:{line:53,column:73}},"28":{start:{line:54,column:8},end:{line:54,column:44}},"29":{start:{line:57,column:4},end:{line:79,column:6}},"30":{start:{line:58,column:20},end:{line:58,column:34}},"31":{start:{line:59,column:28},end:{line:59,column:65}},"32":{start:{line:60,column:8},end:{line:60,column:37}},"33":{start:{line:62,column:8},end:{line:65,column:23}},"34":{start:{line:67,column:8},end:{line:70,column:9}},"35":{start:{line:73,column:23},end:{line:73,column:68}},"36":{start:{line:74,column:25},end:{line:74,column:28}},"37":{start:{line:76,column:8},end:{line:76,column:62}},"38":{start:{line:77,column:8},end:{line:77,column:80}},"39":{start:{line:78,column:8},end:{line:78,column:49}},"40":{start:{line:81,column:4},end:{line:107,column:6}},"41":{start:{line:82,column:25},end:{line:82,column:59}},"42":{start:{line:83,column:8},end:{line:83,column:25}},"43":{start:{line:85,column:28},end:{line:85,column:65}},"44":{start:{line:86,column:8},end:{line:86,column:32}},"45":{start:{line:88,column:29},end:{line:88,column:30}},"46":{start:{line:94,column:8},end:{line:97,column:54}},"47":{start:{line:97,column:20},end:{line:97,column:53}},"48":{start:{line:99,column:25},end:{line:99,column:65}},"49":{start:{line:100,column:23},end:{line:104,column:9}},"50":{start:{line:106,column:8},end:{line:106,column:49}},"51":{start:{line:109,column:4},end:{line:145,column:6}},"52":{start:{line:110,column:20},end:{line:110,column:34}},"53":{start:{line:111,column:28},end:{line:115,column:9}},"54":{start:{line:117,column:25},end:{line:117,column:59}},"55":{start:{line:118,column:8},end:{line:118,column:25}},"56":{start:{line:120,column:29},end:{line:120,column:30}},"57":{start:{line:121,column:24},end:{line:121,column:48}},"58":{start:{line:123,column:20},end:{line:123,column:41}},"59":{start:{line:124,column:8},end:{line:124,column:44}},"60":{start:{line:127,column:8},end:{line:130,column:23}},"61":{start:{line:132,column:31},end:{line:132,column:71}},"62":{start:{line:133,column:23},end:{line:135,column:9}},"63":{start:{line:136,column:25},end:{line:141,column:10}},"64":{start:{line:143,column:8},end:{line:143,column:49}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:35},end:{line:17,column:36}},loc:{start:{line:17,column:41},end:{line:146,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:11},end:{line:20,column:12}},loc:{start:{line:20,column:17},end:{line:24,column:5}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:15},end:{line:25,column:16}},loc:{start:{line:25,column:21},end:{line:27,column:5}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:29,column:14},end:{line:29,column:15}},loc:{start:{line:29,column:20},end:{line:31,column:5}},line:29},"4":{name:"(anonymous_4)",decl:{start:{line:33,column:58},end:{line:33,column:59}},loc:{start:{line:33,column:64},end:{line:38,column:5}},line:33},"5":{name:"(anonymous_5)",decl:{start:{line:40,column:64},end:{line:40,column:65}},loc:{start:{line:40,column:70},end:{line:55,column:5}},line:40},"6":{name:"(anonymous_6)",decl:{start:{line:57,column:64},end:{line:57,column:65}},loc:{start:{line:57,column:76},end:{line:79,column:5}},line:57},"7":{name:"(anonymous_7)",decl:{start:{line:81,column:98},end:{line:81,column:99}},loc:{start:{line:81,column:109},end:{line:107,column:5}},line:81},"8":{name:"(anonymous_8)",decl:{start:{line:97,column:14},end:{line:97,column:15}},loc:{start:{line:97,column:20},end:{line:97,column:53}},line:97},"9":{name:"(anonymous_9)",decl:{start:{line:109,column:85},end:{line:109,column:86}},loc:{start:{line:109,column:97},end:{line:145,column:5}},line:109}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"6d0ac26176e2089419aa5776dc17bbf549412e0d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2mk2n4jli2=function(){return actualCoverage;};}return actualCoverage;}cov_2mk2n4jli2();const{describe,it,before,beforeEach,afterEach}=(cov_2mk2n4jli2().s[0]++,require('mocha'));const CarService=(cov_2mk2n4jli2().s[1]++,require('./../../src/service/carService'));const Transaction=(cov_2mk2n4jli2().s[2]++,require('./../../src/entities/transaction'));const{join}=(cov_2mk2n4jli2().s[3]++,require('path'));const{expect}=(cov_2mk2n4jli2().s[4]++,require('chai'));const sinon=(cov_2mk2n4jli2().s[5]++,require('sinon'));const carsDatabase=(cov_2mk2n4jli2().s[6]++,join(__dirname,'./../../database',"cars.json"));const mocks=(cov_2mk2n4jli2().s[7]++,{validCarCategory:require('./../mocks/valid-carCategory.json'),validCar:require('./../mocks/valid-car.json'),validCustomer:require('./../mocks/valid-customer.json')});cov_2mk2n4jli2().s[8]++;describe('CarService Suite Tests',()=>{cov_2mk2n4jli2().f[0]++;let carService=(cov_2mk2n4jli2().s[9]++,{});let sandbox=(cov_2mk2n4jli2().s[10]++,{});cov_2mk2n4jli2().s[11]++;before(()=>{cov_2mk2n4jli2().f[1]++;cov_2mk2n4jli2().s[12]++;carService=new CarService({cars:carsDatabase});});cov_2mk2n4jli2().s[13]++;beforeEach(()=>{cov_2mk2n4jli2().f[2]++;cov_2mk2n4jli2().s[14]++;sandbox=sinon.createSandbox();});cov_2mk2n4jli2().s[15]++;afterEach(()=>{cov_2mk2n4jli2().f[3]++;cov_2mk2n4jli2().s[16]++;sandbox.restore();});cov_2mk2n4jli2().s[17]++;it('should retrieve a random position from an array',()=>{cov_2mk2n4jli2().f[4]++;const data=(cov_2mk2n4jli2().s[18]++,[0,1,2,3,4]);const result=(cov_2mk2n4jli2().s[19]++,carService.getRandomPositionFromArray(data));cov_2mk2n4jli2().s[20]++;expect(result).to.be.lte(data.length).and.be.gte(0);});cov_2mk2n4jli2().s[21]++;it('should choose the first id from carIds in carCategory',()=>{cov_2mk2n4jli2().f[5]++;const carCategory=(cov_2mk2n4jli2().s[22]++,mocks.validCarCategory);const carIdIndex=(cov_2mk2n4jli2().s[23]++,0);cov_2mk2n4jli2().s[24]++;sandbox.stub(carService,carService.getRandomPositionFromArray.name).returns(carIdIndex);const result=(cov_2mk2n4jli2().s[25]++,carService.chooseRandomCar(carCategory));const expected=(cov_2mk2n4jli2().s[26]++,carCategory.carIds[carIdIndex]);cov_2mk2n4jli2().s[27]++;expect(carService.getRandomPositionFromArray.calledOnce).to.be.ok;cov_2mk2n4jli2().s[28]++;expect(result).to.be.equal(expected);});cov_2mk2n4jli2().s[29]++;it('given a carCategory it should return an available car',async()=>{cov_2mk2n4jli2().f[6]++;const car=(cov_2mk2n4jli2().s[30]++,mocks.validCar);const carCategory=(cov_2mk2n4jli2().s[31]++,Object.create(mocks.validCarCategory));cov_2mk2n4jli2().s[32]++;carCategory.carIds=[car.id];cov_2mk2n4jli2().s[33]++;sandbox.stub(carService.carRepository,carService.carRepository.find.name).resolves(car);cov_2mk2n4jli2().s[34]++;sandbox.spy(carService,carService.chooseRandomCar.name);const result=(cov_2mk2n4jli2().s[35]++,await carService.getAvailableCar(carCategory));const expected=(cov_2mk2n4jli2().s[36]++,car);cov_2mk2n4jli2().s[37]++;expect(carService.chooseRandomCar.calledOnce).to.be.ok;cov_2mk2n4jli2().s[38]++;expect(carService.carRepository.find.calledWithExactly(car.id)).to.be.ok;cov_2mk2n4jli2().s[39]++;expect(result).to.be.deep.equal(expected);});cov_2mk2n4jli2().s[40]++;it('given a carCategory, customer and numberOfDays it should calculate final amount in real',async()=>{cov_2mk2n4jli2().f[7]++;const customer=(cov_2mk2n4jli2().s[41]++,Object.create(mocks.validCustomer));cov_2mk2n4jli2().s[42]++;customer.age=50;const carCategory=(cov_2mk2n4jli2().s[43]++,Object.create(mocks.validCarCategory));cov_2mk2n4jli2().s[44]++;carCategory.price=37.6;const numberOfDays=(cov_2mk2n4jli2().s[45]++,5);// age: 50 - 1.3 tax - categoryPrice 37.6
// 37.6 * 1.3 = 48,88 * 5 days = 244.40
// nao depender de dados externos!
cov_2mk2n4jli2().s[46]++;sandbox.stub(carService,"taxesBasedOnAge").get(()=>{cov_2mk2n4jli2().f[8]++;cov_2mk2n4jli2().s[47]++;return[{from:40,to:50,then:1.3}];});const expected=(cov_2mk2n4jli2().s[48]++,carService.currencyFormat.format(244.40));const result=(cov_2mk2n4jli2().s[49]++,carService.calculateFinalPrice(customer,carCategory,numberOfDays));cov_2mk2n4jli2().s[50]++;expect(result).to.be.deep.equal(expected);});cov_2mk2n4jli2().s[51]++;it('given a customer and a car category it should return a transaction receipt',async()=>{cov_2mk2n4jli2().f[9]++;const car=(cov_2mk2n4jli2().s[52]++,mocks.validCar);const carCategory=(cov_2mk2n4jli2().s[53]++,{...mocks.validCarCategory,price:37.6,carIds:[car.id]});const customer=(cov_2mk2n4jli2().s[54]++,Object.create(mocks.validCustomer));cov_2mk2n4jli2().s[55]++;customer.age=20;const numberOfDays=(cov_2mk2n4jli2().s[56]++,5);const dueDate=(cov_2mk2n4jli2().s[57]++,"10 de novembro de 2020");const now=(cov_2mk2n4jli2().s[58]++,new Date(2020,10,5));cov_2mk2n4jli2().s[59]++;sandbox.useFakeTimers(now.getTime());// age: 20, tax: 1.1, categoryPrice: 37.6
// 37.6 * 1.1 = 41.36 * 5 days = 206.8
cov_2mk2n4jli2().s[60]++;sandbox.stub(carService.carRepository,carService.carRepository.find.name).resolves(car);const expectedAmount=(cov_2mk2n4jli2().s[61]++,carService.currencyFormat.format(206.80));const result=(cov_2mk2n4jli2().s[62]++,await carService.rent(customer,carCategory,numberOfDays));const expected=(cov_2mk2n4jli2().s[63]++,new Transaction({customer,car,dueDate,amount:expectedAmount}));cov_2mk2n4jli2().s[64]++;expect(result).to.be.deep.equal(expected);});});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhclNlcnZpY2UudGVzdC5qcyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiYmVmb3JlIiwiYmVmb3JlRWFjaCIsImFmdGVyRWFjaCIsInJlcXVpcmUiLCJDYXJTZXJ2aWNlIiwiVHJhbnNhY3Rpb24iLCJqb2luIiwiZXhwZWN0Iiwic2lub24iLCJjYXJzRGF0YWJhc2UiLCJfX2Rpcm5hbWUiLCJtb2NrcyIsInZhbGlkQ2FyQ2F0ZWdvcnkiLCJ2YWxpZENhciIsInZhbGlkQ3VzdG9tZXIiLCJjYXJTZXJ2aWNlIiwic2FuZGJveCIsImNhcnMiLCJjcmVhdGVTYW5kYm94IiwicmVzdG9yZSIsImRhdGEiLCJyZXN1bHQiLCJnZXRSYW5kb21Qb3NpdGlvbkZyb21BcnJheSIsInRvIiwiYmUiLCJsdGUiLCJsZW5ndGgiLCJhbmQiLCJndGUiLCJjYXJDYXRlZ29yeSIsImNhcklkSW5kZXgiLCJzdHViIiwibmFtZSIsInJldHVybnMiLCJjaG9vc2VSYW5kb21DYXIiLCJleHBlY3RlZCIsImNhcklkcyIsImNhbGxlZE9uY2UiLCJvayIsImVxdWFsIiwiY2FyIiwiT2JqZWN0IiwiY3JlYXRlIiwiaWQiLCJjYXJSZXBvc2l0b3J5IiwiZmluZCIsInJlc29sdmVzIiwic3B5IiwiZ2V0QXZhaWxhYmxlQ2FyIiwiY2FsbGVkV2l0aEV4YWN0bHkiLCJkZWVwIiwiY3VzdG9tZXIiLCJhZ2UiLCJwcmljZSIsIm51bWJlck9mRGF5cyIsImdldCIsImZyb20iLCJ0aGVuIiwiY3VycmVuY3lGb3JtYXQiLCJmb3JtYXQiLCJjYWxjdWxhdGVGaW5hbFByaWNlIiwiZHVlRGF0ZSIsIm5vdyIsIkRhdGUiLCJ1c2VGYWtlVGltZXJzIiwiZ2V0VGltZSIsImV4cGVjdGVkQW1vdW50IiwicmVudCIsImFtb3VudCJdLCJtYXBwaW5ncyI6InlxTUFlWTsyRkFmWixLQUFNLENBQUVBLFFBQUYsQ0FBWUMsRUFBWixDQUFnQkMsTUFBaEIsQ0FBd0JDLFVBQXhCLENBQW9DQyxTQUFwQywyQkFB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QUNNeUIsWUFETixDQUFULENBQVosQ0FHQSxLQUFNbkIsQ0FBQUEsUUFBUSwyQkFBRyxHQUFJOUIsQ0FBQUEsV0FBSixDQUFnQixDQUM3QjhDLFFBRDZCLENBRTdCWCxHQUY2QixDQUc3QnFCLE9BSDZCLENBSTdCTyxNQUFNLENBQUVGLGNBSnFCLENBQWhCLENBQUgsQ0FBZCxDQTNCeUYseUJBa0N6RjNELE1BQU0sQ0FBQ2MsTUFBRCxDQUFOLENBQWVFLEVBQWYsQ0FBa0JDLEVBQWxCLENBQXFCMEIsSUFBckIsQ0FBMEJYLEtBQTFCLENBQWdDSixRQUFoQyxFQUVILENBcENDLENBQUYsQ0FxQ0gsQ0FqSU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgZGVzY3JpYmUsIGl0LCBiZWZvcmUsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9ID0gcmVxdWlyZSgnbW9jaGEnKVxuY29uc3QgQ2FyU2VydmljZSA9IHJlcXVpcmUoJy4vLi4vLi4vc3JjL3NlcnZpY2UvY2FyU2VydmljZScpXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4vLi4vLi4vc3JjL2VudGl0aWVzL3RyYW5zYWN0aW9uJylcblxuY29uc3QgeyBqb2luIH0gPSByZXF1aXJlKCdwYXRoJylcbmNvbnN0IHsgZXhwZWN0IH0gPSByZXF1aXJlKCdjaGFpJylcbmNvbnN0IHNpbm9uID0gcmVxdWlyZSgnc2lub24nKVxuXG5jb25zdCBjYXJzRGF0YWJhc2UgPSBqb2luKF9fZGlybmFtZSwgJy4vLi4vLi4vZGF0YWJhc2UnLCBcImNhcnMuanNvblwiKVxuXG5jb25zdCBtb2NrcyA9IHtcbiAgICB2YWxpZENhckNhdGVnb3J5OiByZXF1aXJlKCcuLy4uL21vY2tzL3ZhbGlkLWNhckNhdGVnb3J5Lmpzb24nKSxcbiAgICB2YWxpZENhcjogcmVxdWlyZSgnLi8uLi9tb2Nrcy92YWxpZC1jYXIuanNvbicpLFxuICAgIHZhbGlkQ3VzdG9tZXI6IHJlcXVpcmUoJy4vLi4vbW9ja3MvdmFsaWQtY3VzdG9tZXIuanNvbicpLFxufVxuXG5kZXNjcmliZSgnQ2FyU2VydmljZSBTdWl0ZSBUZXN0cycsICgpID0+IHtcbiAgICBsZXQgY2FyU2VydmljZSA9IHt9XG4gICAgbGV0IHNhbmRib3ggPSB7fVxuICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgIGNhclNlcnZpY2UgPSBuZXcgQ2FyU2VydmljZSh7XG4gICAgICAgICAgICBjYXJzOiBjYXJzRGF0YWJhc2VcbiAgICAgICAgfSlcbiAgICB9KVxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpXG4gICAgfSlcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgYSByYW5kb20gcG9zaXRpb24gZnJvbSBhbiBhcnJheScsICgpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFswLCAxLCAyLCAzLCA0XVxuICAgICAgICBjb25zdCByZXN1bHQgPSBjYXJTZXJ2aWNlLmdldFJhbmRvbVBvc2l0aW9uRnJvbUFycmF5KGRhdGEpXG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUubHRlKGRhdGEubGVuZ3RoKS5hbmQuYmUuZ3RlKDApXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgY2hvb3NlIHRoZSBmaXJzdCBpZCBmcm9tIGNhcklkcyBpbiBjYXJDYXRlZ29yeScsICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FyQ2F0ZWdvcnkgPSBtb2Nrcy52YWxpZENhckNhdGVnb3J5XG4gICAgICAgIGNvbnN0IGNhcklkSW5kZXggPSAwXG5cbiAgICAgICAgc2FuZGJveC5zdHViKFxuICAgICAgICAgICAgY2FyU2VydmljZSxcbiAgICAgICAgICAgIGNhclNlcnZpY2UuZ2V0UmFuZG9tUG9zaXRpb25Gcm9tQXJyYXkubmFtZVxuICAgICAgICApLnJldHVybnMoY2FySWRJbmRleClcblxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNhclNlcnZpY2UuY2hvb3NlUmFuZG9tQ2FyKGNhckNhdGVnb3J5KVxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IGNhckNhdGVnb3J5LmNhcklkc1tjYXJJZEluZGV4XVxuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGNhclNlcnZpY2UuZ2V0UmFuZG9tUG9zaXRpb25Gcm9tQXJyYXkuY2FsbGVkT25jZSkudG8uYmUub2tcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZXF1YWwoZXhwZWN0ZWQpXG4gICAgfSlcblxuICAgIGl0KCdnaXZlbiBhIGNhckNhdGVnb3J5IGl0IHNob3VsZCByZXR1cm4gYW4gYXZhaWxhYmxlIGNhcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FyID0gbW9ja3MudmFsaWRDYXJcbiAgICAgICAgY29uc3QgY2FyQ2F0ZWdvcnkgPSBPYmplY3QuY3JlYXRlKG1vY2tzLnZhbGlkQ2FyQ2F0ZWdvcnkpXG4gICAgICAgIGNhckNhdGVnb3J5LmNhcklkcyA9IFtjYXIuaWRdXG4gICAgICAgIFxuICAgICAgICBzYW5kYm94LnN0dWIoXG4gICAgICAgICAgICBjYXJTZXJ2aWNlLmNhclJlcG9zaXRvcnksXG4gICAgICAgICAgICBjYXJTZXJ2aWNlLmNhclJlcG9zaXRvcnkuZmluZC5uYW1lLFxuICAgICAgICApLnJlc29sdmVzKGNhcilcblxuICAgICAgICBzYW5kYm94LnNweShcbiAgICAgICAgICAgIGNhclNlcnZpY2UsXG4gICAgICAgICAgICBjYXJTZXJ2aWNlLmNob29zZVJhbmRvbUNhci5uYW1lLFxuICAgICAgICApXG4gICAgICAgIFxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhclNlcnZpY2UuZ2V0QXZhaWxhYmxlQ2FyKGNhckNhdGVnb3J5KVxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IGNhclxuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGNhclNlcnZpY2UuY2hvb3NlUmFuZG9tQ2FyLmNhbGxlZE9uY2UpLnRvLmJlLm9rXG4gICAgICAgIGV4cGVjdChjYXJTZXJ2aWNlLmNhclJlcG9zaXRvcnkuZmluZC5jYWxsZWRXaXRoRXhhY3RseShjYXIuaWQpKS50by5iZS5va1xuICAgICAgICBleHBlY3QocmVzdWx0KS50by5iZS5kZWVwLmVxdWFsKGV4cGVjdGVkKVxuICAgIH0pXG5cbiAgICBpdCgnZ2l2ZW4gYSBjYXJDYXRlZ29yeSwgY3VzdG9tZXIgYW5kIG51bWJlck9mRGF5cyBpdCBzaG91bGQgY2FsY3VsYXRlIGZpbmFsIGFtb3VudCBpbiByZWFsJywgYXN5bmMoKSA9PiB7XG4gICAgICAgIGNvbnN0IGN1c3RvbWVyID0gT2JqZWN0LmNyZWF0ZShtb2Nrcy52YWxpZEN1c3RvbWVyKVxuICAgICAgICBjdXN0b21lci5hZ2UgPSA1MFxuXG4gICAgICAgIGNvbnN0IGNhckNhdGVnb3J5ID0gT2JqZWN0LmNyZWF0ZShtb2Nrcy52YWxpZENhckNhdGVnb3J5KVxuICAgICAgICBjYXJDYXRlZ29yeS5wcmljZSA9IDM3LjZcblxuICAgICAgICBjb25zdCBudW1iZXJPZkRheXMgPSA1XG5cbiAgICAgICAgLy8gYWdlOiA1MCAtIDEuMyB0YXggLSBjYXRlZ29yeVByaWNlIDM3LjZcbiAgICAgICAgLy8gMzcuNiAqIDEuMyA9IDQ4LDg4ICogNSBkYXlzID0gMjQ0LjQwXG5cbiAgICAgICAgLy8gbmFvIGRlcGVuZGVyIGRlIGRhZG9zIGV4dGVybm9zIVxuICAgICAgICBzYW5kYm94LnN0dWIoXG4gICAgICAgICAgICBjYXJTZXJ2aWNlLFxuICAgICAgICAgICAgXCJ0YXhlc0Jhc2VkT25BZ2VcIlxuICAgICAgICApLmdldCgoKSA9PiBbeyBmcm9tOiA0MCwgdG86IDUwLCB0aGVuOiAxLjMgfV0pXG4gICAgICAgIFxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IGNhclNlcnZpY2UuY3VycmVuY3lGb3JtYXQuZm9ybWF0KDI0NC40MClcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY2FyU2VydmljZS5jYWxjdWxhdGVGaW5hbFByaWNlKFxuICAgICAgICAgICAgY3VzdG9tZXIsXG4gICAgICAgICAgICBjYXJDYXRlZ29yeSxcbiAgICAgICAgICAgIG51bWJlck9mRGF5c1xuICAgICAgICApXG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZClcbiAgICB9KVxuXG4gICAgaXQoJ2dpdmVuIGEgY3VzdG9tZXIgYW5kIGEgY2FyIGNhdGVnb3J5IGl0IHNob3VsZCByZXR1cm4gYSB0cmFuc2FjdGlvbiByZWNlaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjYXIgPSBtb2Nrcy52YWxpZENhclxuICAgICAgICBjb25zdCBjYXJDYXRlZ29yeSA9IHtcbiAgICAgICAgICAgIC4uLm1vY2tzLnZhbGlkQ2FyQ2F0ZWdvcnksXG4gICAgICAgICAgICBwcmljZTogMzcuNixcbiAgICAgICAgICAgIGNhcklkczogW2Nhci5pZF1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgY3VzdG9tZXIgPSBPYmplY3QuY3JlYXRlKG1vY2tzLnZhbGlkQ3VzdG9tZXIpXG4gICAgICAgIGN1c3RvbWVyLmFnZSA9IDIwXG5cbiAgICAgICAgY29uc3QgbnVtYmVyT2ZEYXlzID0gNVxuICAgICAgICBjb25zdCBkdWVEYXRlID0gXCIxMCBkZSBub3ZlbWJybyBkZSAyMDIwXCJcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKDIwMjAsIDEwLCA1KVxuICAgICAgICBzYW5kYm94LnVzZUZha2VUaW1lcnMobm93LmdldFRpbWUoKSlcbiAgICAgICAgLy8gYWdlOiAyMCwgdGF4OiAxLjEsIGNhdGVnb3J5UHJpY2U6IDM3LjZcbiAgICAgICAgLy8gMzcuNiAqIDEuMSA9IDQxLjM2ICogNSBkYXlzID0gMjA2LjhcbiAgICAgICAgc2FuZGJveC5zdHViKFxuICAgICAgICAgICAgY2FyU2VydmljZS5jYXJSZXBvc2l0b3J5LFxuICAgICAgICAgICAgY2FyU2VydmljZS5jYXJSZXBvc2l0b3J5LmZpbmQubmFtZSxcbiAgICAgICAgKS5yZXNvbHZlcyhjYXIpXG4gICAgICAgIFxuICAgICAgICBjb25zdCBleHBlY3RlZEFtb3VudCA9IGNhclNlcnZpY2UuY3VycmVuY3lGb3JtYXQuZm9ybWF0KDIwNi44MClcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FyU2VydmljZS5yZW50KFxuICAgICAgICAgICAgY3VzdG9tZXIsIGNhckNhdGVnb3J5LCBudW1iZXJPZkRheXNcbiAgICAgICAgKVxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IG5ldyBUcmFuc2FjdGlvbih7XG4gICAgICAgICAgICBjdXN0b21lcixcbiAgICAgICAgICAgIGNhcixcbiAgICAgICAgICAgIGR1ZURhdGUsXG4gICAgICAgICAgICBhbW91bnQ6IGV4cGVjdGVkQW1vdW50LFxuICAgICAgICB9KVxuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmRlZXAuZXF1YWwoZXhwZWN0ZWQpXG4gICAgICAgIFxuICAgIH0pXG59KSJdfQ==